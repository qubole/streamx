env_vars=`env | grep CONNECT`

# Override connect-distributed.properties with env_vars
python /usr/local/streamx/utils.py $env_vars
if [ $? -ne 0 ]; then
 echo "Exiting : Streamx startup script utils.py exited with non-zero exit code"
 exit
fi

CONNECT_CONF=/usr/local/streamx/config/connect-distributed-override.properties

cat $CONNECT_CONF

# Launch StreamX
export CLASSPATH=/usr/local/streamx/*
env | grep LOG_TO_FILE
if [[ $? -eq 0 ]]; then
  cp /usr/local/streamx/config/connect-log4j.properties /etc/kafka/
  hostname=`hostname`
  export KAFKA_OPTS="-Dcontainer_directory=$hostname"
fi
#set aws credentials as system properties
export KAFKA_OPTS="$KAFKA_OPTS -Daws_access_key=$CONNECT_AWS_ACCESS_KEY -Daws_secret=$CONNECT_AWS_SECRET_KEY"

/usr/bin/connect-distributed $CONNECT_CONF
