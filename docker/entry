env_vars=`env | grep CONNECT`

# Override connect-distributed.properties with env_vars
python /usr/local/streamx/utils.py $env_vars
if [ $? -ne 0 ]; then
 echo "Exiting : Streamx startup script utils.py exited with non-zero exit code"
 exit
fi

CONNECT_DISTRIBUTED_CONF=/usr/local/streamx/config/connect-distributed-override.properties
CONNECT_STANDALONE_CONF=/usr/local/streamx/config/connect-standalone.properties
S3_PROPS=/usr/local/streamx/config/quickstart-s3.properties


# Launch StreamX
export CLASSPATH=/usr/local/streamx/*
env | grep LOG_TO_FILE
if [[ $? -eq 0 ]]; then
  cp /usr/local/streamx/config/connect-log4j.properties /etc/kafka/
  hostname=`hostname`
  export KAFKA_OPTS="-Dcontainer_directory=$hostname"
fi
#set aws credentials as system properties
export KAFKA_OPTS="$KAFKA_OPTS -Daws_access_key=$CONNECT_AWS_ACCESS_KEY -Daws_secret=$CONNECT_AWS_SECRET_KEY"

if [ ! -z "$DISTRIBUTED_MODE" ] ; then
  echo "Starting kafka connect in distributed mode"
  cat $CONNECT_DISTRIBUTED_CONF
  /usr/bin/connect-distributed $CONNECT_DISTRIBUTED_CONF
else
  echo "Starting kafka connect in standalone mode"
  /usr/bin/connect-standalone $CONNECT_STANDALONE_CONF $S3_PROPS
fi

